<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [S3d-svn] r409 - trunk/apps/olsrs3d
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/s3d-svn/2006-September/index.html" >
   <LINK REL="made" HREF="mailto:s3d-svn%40lists.berlios.de?Subject=Re%3A%20%5BS3d-svn%5D%20r409%20-%20trunk/apps/olsrs3d&In-Reply-To=%3C200609172311.k8HNBjgZ007038%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000401.html">
   <LINK REL="Next"  HREF="000403.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[S3d-svn] r409 - trunk/apps/olsrs3d</H1>
    <B>marec at BerliOS</B> 
    <A HREF="mailto:s3d-svn%40lists.berlios.de?Subject=Re%3A%20%5BS3d-svn%5D%20r409%20-%20trunk/apps/olsrs3d&In-Reply-To=%3C200609172311.k8HNBjgZ007038%40sheep.berlios.de%3E"
       TITLE="[S3d-svn] r409 - trunk/apps/olsrs3d">marec at mail.berlios.de
       </A><BR>
    <I>Mon Sep 18 01:11:45 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000401.html">[S3d-svn] r408 - in trunk: . libs3d
</A></li>
        <LI>Next message: <A HREF="000403.html">[S3d-svn] r410 - in trunk: . libs3dw
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#402">[ date ]</a>
              <a href="thread.html#402">[ thread ]</a>
              <a href="subject.html#402">[ subject ]</a>
              <a href="author.html#402">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: marec
Date: 2006-09-18 01:11:44 +0200 (Mon, 18 Sep 2006)
New Revision: 409

Modified:
   trunk/apps/olsrs3d/main.c
   trunk/apps/olsrs3d/search.c
Log:
olsrs3d help window fixed II (more labels added)
IP search on RETURN reenabled
IP search fixed

Modified: trunk/apps/olsrs3d/main.c
===================================================================
--- trunk/apps/olsrs3d/main.c	2006-09-17 22:39:21 UTC (rev 408)
+++ trunk/apps/olsrs3d/main.c	2006-09-17 23:11:44 UTC (rev 409)
@@ -118,17 +118,27 @@
 	infwin = s3dw_surface_new( &quot;Help Window&quot;, 20, 19 );
 
 	/*s3dw_label_new(infwin,&quot;C        - Colour On/Off&quot;,1,2);*/
-	s3dw_label_new(infwin,&quot;C&quot;,1,2); 						s3dw_label_new(infwin,&quot;- Colour On/Off&quot;,3,2);
-	s3dw_label_new(infwin,&quot;R        - Rotation On/Off&quot;,1,4);
-	s3dw_label_new(infwin,&quot;+        - Increase Rotation Speed&quot;,1,5);
-	s3dw_label_new(infwin,&quot; -        - Decrease Rotation Speed&quot;,1,6);
-	s3dw_label_new(infwin,&quot;S        - Search IP&quot;,1,8);
-	s3dw_label_new(infwin,&quot;ESC      - Disable FollowMode&quot;,1,9);
-	s3dw_label_new(infwin,&quot;PGUP     - Increase Drift Factor&quot;,1,11);
-	s3dw_label_new(infwin,&quot;PGDOWN   - Decrease Drift Factor&quot;,1,12);
-	s3dw_label_new(infwin,&quot;STRG + P - Reset Nodes&quot;,1,14);
+	s3dw_label_new(infwin,&quot;c&quot;,1,2);
+	s3dw_label_new(infwin,&quot;- Colour On/Off&quot;,6,2);
+	/*s3dw_label_new(infwin,&quot;r        - Rotation On/Off&quot;,1,4);*/
+	s3dw_label_new(infwin,&quot;r&quot;,1,4);
+	s3dw_label_new(infwin,&quot;- Rotation On/Off&quot;,6,4);
+	s3dw_label_new(infwin,&quot;+&quot;,1,5);
+	s3dw_label_new(infwin,&quot;- Increase Rotation Speed&quot;,6,5);
+	s3dw_label_new(infwin,&quot;-&quot;,1,6);
+	s3dw_label_new(infwin,&quot;- Decrease Rotation Speed&quot;,6,6);
+	s3dw_label_new(infwin,&quot;s&quot;,1,8);
+	s3dw_label_new(infwin,&quot;- Search IP&quot;,6,8);
+	s3dw_label_new(infwin,&quot;ESC&quot;,1,9);
+	s3dw_label_new(infwin,&quot;- Disable FollowMode&quot;,6,9);
+	s3dw_label_new(infwin,&quot;PGUP&quot;,1,11);
+	s3dw_label_new(infwin,&quot;- Increase Drift Factor&quot;,6,11);
+	s3dw_label_new(infwin,&quot;PGDOWN&quot;,1,12);
+	s3dw_label_new(infwin,&quot;- Decrease Drift Factor&quot;,6,12);
+	s3dw_label_new(infwin,&quot;STRG + p&quot;,1,14);
+	s3dw_label_new(infwin,&quot;- Reset Nodes&quot;,6,14);
 
-	button=s3dw_button_new(infwin,&quot;OK&quot;,10,16);
+	button=s3dw_button_new(infwin,&quot;OK&quot;,9,16);
 	button-&gt;onclick = close_win;
 	s3dw_show(S3DWIDGET(infwin));
 
@@ -789,6 +799,7 @@
 			case S3DK_s: /* move to search widget, give widget focus */
 
 				set_search_status(WIDGET);							/* set status for mainloop */
+				set_node_root( Olsr_root );
 				show_search_window();
 /*				set_return_point(CamPosition[0],CamPosition[1]);	/ * save the return position * /
 				set_node_root( Olsr_root );*/

Modified: trunk/apps/olsrs3d/search.c
===================================================================
--- trunk/apps/olsrs3d/search.c	2006-09-17 22:39:21 UTC (rev 408)
+++ trunk/apps/olsrs3d/search.c	2006-09-17 23:11:44 UTC (rev 409)
@@ -1,21 +1,21 @@
 /*
  * search.c
- * 
+ *
  * Copyright (C) 2006 Andreas Langer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/s3d-svn">andreas_lbg at gmx.de</A>&gt;
  *
  * This file is part of the olsrs3d, an olsr topology visualizer for s3d.
  * See <A HREF="http://s3d.berlios.de/">http://s3d.berlios.de/</A> for more updates.
- * 
+ *
  * s3d is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation; either version 2 of the License, or
  * (at your option) any later version.
- * 
+ *
  * s3d is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
- * 
+ *
  * You should have received a copy of the GNU General Public License
  * along with s3d; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
@@ -40,7 +40,7 @@
 
 float	_return_point[2][3];				/* cam position before move to the widget */
 int		_search_status = NOTHING;			/* status of search */
-											
+
 void _search_node(s3dw_widget *dummy);
 void _new_search_node(s3dw_widget *dummy);
 void _abort_search(s3dw_widget *dummy);
@@ -54,7 +54,7 @@
 		  tmp_vec[3],
 		  diff_vec[3],
 		  angle;
-	
+
 	real_node_pos[0] =  (*search_node)-&gt;pos_vec[0] * cos( rotate * M_PI / 180.0 ) - (*search_node)-&gt;pos_vec[2] * -sin ( rotate * M_PI / 180.0 );
 	real_node_pos[1] =  (*search_node)-&gt;pos_vec[1];
 	real_node_pos[2] =  (*search_node)-&gt;pos_vec[0] * -sin( rotate * M_PI / 180.0) + (*search_node)-&gt;pos_vec[2] * cos ( rotate * M_PI / 180.0 );
@@ -62,15 +62,15 @@
 	cam_target[0] = ( real_node_pos[0] + 7);
 	cam_target[1] =   real_node_pos[1];
 	cam_target[2] = ( real_node_pos[2] + 7);
-	
+
 	cam_position_t[0]=( cam_position_t[0] * 4 + cam_target[0] ) / 5;
 	cam_position_t[1]=( cam_position_t[1] * 4 + cam_target[1] ) / 5;
 	cam_position_t[2]=( cam_position_t[2] * 4 + cam_target[2] ) / 5;
-	
+
 	tmp_vec[0] =  0.0;
 	tmp_vec[1] =  0.0;
 	tmp_vec[2] = -1.0;
-	
+
 	diff_vec[0] = cam_position_t[0] - real_node_pos[0];
 	diff_vec[1] = 0.0;
 	diff_vec[2] = cam_position_t[2] - real_node_pos[2];
@@ -78,7 +78,7 @@
 	/* angle = ( real_node_pos[0] &gt; 0) ? ( 180 - ( 180 / M_PI * angle ) ) : ( 180 + ( 180 / M_PI * angle ) ); */
 	angle = 180 - ( 180 / M_PI * angle );
 	cam_position_r[1] = ( cam_position_r[1] * 4 + angle ) / 5;
-	
+
 	s3d_translate( 0, cam_position_t[0], cam_position_t[1], cam_position_t[2] );
 	s3d_rotate( 0, cam_position_r[0], cam_position_r[1], cam_position_r[2] );
 }
@@ -93,45 +93,46 @@
 void show_search_window()
 {
 	s3dw_button *search_button, *abort_button;
-	
+
 	_search_surface	= s3dw_surface_new( &quot;Node Search&quot;, 17, 10 );
 	_search_input	= s3dw_input_new( _search_surface, 15, 1, 4 );
-	
+
 	s3dw_label_new( _search_surface, &quot;Enter the IP of the node.&quot;, 1, 2);
 	s3dw_focus( S3DWIDGET( _search_input ) );
-	
+
 	search_button = s3dw_button_new( _search_surface, &quot;Search&quot;, 11.5, 7 );
 	abort_button  = s3dw_button_new( _search_surface, &quot;Abort&quot;, 1, 7 );
 	search_button-&gt;onclick = _new_search_node;
 	abort_button-&gt;onclick = _abort_search_window;
 
 	/* TODO calc position for ok button */
-	
-	s3dw_focus	( S3DWIDGET( _search_input ) );	
+
+	s3dw_focus	( S3DWIDGET( _search_input ) );
 	s3dw_focus	( S3DWIDGET( _search_surface ) );
 	s3dw_show	( S3DWIDGET( _search_surface ) );
 
+	_search_widget	= search_button;
 }
 
 /* public */
 void create_search_widget(float x, float y, float z)
 {
 	s3dw_button *search_button, *abort_button;
-	
+
 	_search_surface	= s3dw_surface_new( &quot;Node Search&quot;, 17, 10 );
 	_search_input	= s3dw_input_new( _search_surface, 15, 1, 4 );
-	
+
 	s3dw_label_new( _search_surface, &quot;Enter the IP of the node.&quot;, 1, 2);
 	s3dw_focus( S3DWIDGET( _search_input ) );
-	
+
 	search_button = s3dw_button_new( _search_surface, &quot;Search&quot;, 11.5, 7 );
 	abort_button  = s3dw_button_new( _search_surface, &quot;Abort&quot;, 1, 7 );
 	search_button-&gt;onclick = _search_node;
 	abort_button-&gt;onclick = _abort_search;
 
 	/* TODO calc position for ok button */
-	
-	s3dw_focus	( S3DWIDGET( _search_input ) );	
+
+	s3dw_focus	( S3DWIDGET( _search_input ) );
 	s3dw_focus	( S3DWIDGET( _search_surface ) );
 	s3dw_show	( S3DWIDGET( _search_surface ) );
 
@@ -154,7 +155,7 @@
 void move_to_search_widget(float cam_position_t[], float cam_position_r[])
 {
 	float target, current;
-	
+
 	set_search_status(WIDGET);
 	cam_position_t[0] = ( cam_position_t[0] * 4 + _search_widget-&gt;x ) / 5;
 	cam_position_t[1] = ( cam_position_t[1] * 4 + _search_widget-&gt;y ) / 5;
@@ -186,12 +187,12 @@
 	if( _search_widget-&gt;arz - cam_position_r[2] &lt; -180 )
 		current -= 360;
 	cam_position_r[2] = ( cam_position_r[2] * 4 + target ) / 5;
-	
+
 	s3d_translate(0,cam_position_t[0],cam_position_t[1],cam_position_t[2]);
 	s3d_rotate(0,cam_position_r[0],cam_position_r[1],cam_position_r[2]);
-	
-	if ( sqrt(  (( cam_position_t[0] - _search_widget-&gt;x)*( cam_position_t[0] - _search_widget-&gt;x)) + 
-				(( cam_position_t[1] - _search_widget-&gt;y)*( cam_position_t[1] - _search_widget-&gt;y)) + 
+
+	if ( sqrt(  (( cam_position_t[0] - _search_widget-&gt;x)*( cam_position_t[0] - _search_widget-&gt;x)) +
+				(( cam_position_t[1] - _search_widget-&gt;y)*( cam_position_t[1] - _search_widget-&gt;y)) +
 				(( cam_position_t[2] - _search_widget-&gt;z)*( cam_position_t[2] - _search_widget-&gt;z)) ) &lt; 0.2 )
 	{
 		s3d_translate( 0, _search_widget-&gt;x, _search_widget-&gt;y, ( _search_widget-&gt;z - 10 ) );
@@ -234,12 +235,12 @@
 	if( _return_point[1][2] - cam_position_r[2] &lt; -180 )
 		current -= 360;
 	cam_position_r[2] = ( cam_position_r[2] * 4 + target ) / 5;
-	
+
 	s3d_translate(0,cam_position_t[0],cam_position_t[1],cam_position_t[2]);
 	s3d_rotate(0,cam_position_r[0],cam_position_r[1],cam_position_r[2]);
-	
-	if ( sqrt(  (( cam_position_t[0] - _return_point[0][0])*( cam_position_t[0] - _return_point[0][0])) + 
-				(( cam_position_t[1] - _return_point[0][1])*( cam_position_t[1] - _return_point[0][1])) + 
+
+	if ( sqrt(  (( cam_position_t[0] - _return_point[0][0])*( cam_position_t[0] - _return_point[0][0])) +
+				(( cam_position_t[1] - _return_point[0][1])*( cam_position_t[1] - _return_point[0][1])) +
 				(( cam_position_t[2] - _return_point[0][2])*( cam_position_t[2] - _return_point[0][2])) ) &lt; 0.2 )
 	{
 		s3d_translate( 0, _return_point[0][0], _return_point[0][1], _return_point[0][2] );
@@ -249,18 +250,18 @@
 }
 
 /* public */
-/* TODO: WTF?! 
- * please fix: 
- *  - s is not initialized but still strlen() is used?! 
+/* TODO: WTF?!
+ * please fix:
+ *  - s is not initialized but still strlen() is used?!
  *  - s will vanish after the function is processed. global variable would be better
  *  - don't forget the terminating \0 after writing a key */
 void search_widget_write(int key)
 {
 	static char s[20];
 	int ln = strlen(s);
-	
+
 	if( key == S3DK_COMMA ) key = S3DK_PERIOD;
-	
+
 	if( key != S3DK_RETURN )
 	{
 		if( key == S3DK_BACKSPACE )
@@ -273,7 +274,7 @@
 		}
 		s3dw_input_change_text( _search_input, s );
 	} else {
-		_search_node( _search_widget );	
+		_new_search_node( _search_widget );
 	}
 }
 
@@ -310,19 +311,20 @@
 {
 	char *ip;
 	int result;
-	
+
 	search_node = &amp;_node_root;
-	
+
 	ip = s3dw_input_gettext( _search_input );
-	
+
 	while ( (*search_node) != NULL )
 	{
 
 		result = strncmp( (*search_node)-&gt;ip, ip, NAMEMAX );
 
-		if ( result == 0 ) 
+		printf( &quot;ip: %s\n&quot;, (*search_node)-&gt;ip );
+		if ( result == 0 )
 			break;
-		
+
 		if ( result &lt; 0 )
 			(*search_node) = (*search_node)-&gt;right;
 		else
@@ -336,7 +338,6 @@
 
 	if( (*search_node) != NULL )
 	{
-		window_error(&quot;Okay, following&quot;);
 		set_search_status( FOLLOW );
 	}
 	else
@@ -350,19 +351,19 @@
 {
 	char *ip;
 	int result;
-	
+
 	search_node = &amp;_node_root;
-	
+
 	ip = s3dw_input_gettext( _search_input );
-	
+
 	while ( (*search_node) != NULL )
 	{
 
 		result = strncmp( (*search_node)-&gt;ip, ip, NAMEMAX );
 
-		if ( result == 0 ) 
+		if ( result == 0 )
 			break;
-		
+
 		if ( result &lt; 0 )
 			(*search_node) = (*search_node)-&gt;right;
 		else


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000401.html">[S3d-svn] r408 - in trunk: . libs3d
</A></li>
	<LI>Next message: <A HREF="000403.html">[S3d-svn] r410 - in trunk: . libs3dw
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#402">[ date ]</a>
              <a href="thread.html#402">[ thread ]</a>
              <a href="subject.html#402">[ subject ]</a>
              <a href="author.html#402">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/s3d-svn">More information about the S3d-svn
mailing list</a><br>
</body></html>
