<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [S3d-svn] r790 - in trunk: . apps/comptest
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/s3d-svn/2007-October/index.html" >
   <LINK REL="made" HREF="mailto:s3d-svn%40lists.berlios.de?Subject=Re%3A%20%5BS3d-svn%5D%20r790%20-%20in%20trunk%3A%20.%20apps/comptest&In-Reply-To=%3C200710191832.l9JIW9iL020062%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000781.html">
   <LINK REL="Next"  HREF="000783.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[S3d-svn] r790 - in trunk: . apps/comptest</H1>
    <B>dotslash at BerliOS</B> 
    <A HREF="mailto:s3d-svn%40lists.berlios.de?Subject=Re%3A%20%5BS3d-svn%5D%20r790%20-%20in%20trunk%3A%20.%20apps/comptest&In-Reply-To=%3C200710191832.l9JIW9iL020062%40sheep.berlios.de%3E"
       TITLE="[S3d-svn] r790 - in trunk: . apps/comptest">dotslash at mail.berlios.de
       </A><BR>
    <I>Fri Oct 19 20:32:09 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000781.html">[S3d-svn] r789 - trunk/apps/comptest
</A></li>
        <LI>Next message: <A HREF="000783.html">[S3d-svn] r791 - trunk/apps/comptest
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#782">[ date ]</a>
              <a href="thread.html#782">[ thread ]</a>
              <a href="subject.html#782">[ subject ]</a>
              <a href="author.html#782">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dotslash
Date: 2007-10-19 20:32:08 +0200 (Fri, 19 Oct 2007)
New Revision: 790

Modified:
   trunk/
   trunk/apps/comptest/comptest.c
Log:
 <A HREF="https://lists.berlios.de/mailman/listinfo/s3d-svn">r2735 at kero</A>:  dotslash | 2007-10-19 20:31:46 +0200
 - astyled comptest



Property changes on: trunk
___________________________________________________________________
Name: svk:merge
   - bf2c72c7-850b-0410-b9e4-c1fddb578f10:/s3d-trunk:2731
   + bf2c72c7-850b-0410-b9e4-c1fddb578f10:/s3d-trunk:2735

Modified: trunk/apps/comptest/comptest.c
===================================================================
--- trunk/apps/comptest/comptest.c	2007-10-19 16:12:56 UTC (rev 789)
+++ trunk/apps/comptest/comptest.c	2007-10-19 18:32:08 UTC (rev 790)
@@ -43,13 +43,13 @@
 #endif
 #endif
 
-#define MAXEVENTS	50		/* maximum events per loop. */
+#define MAXEVENTS 50  /* maximum events per loop. */
 
 /* must be 2^x */
 #define TEXW 256
 #define TEXH 256
-#define TEXNUM(win, x, y)	\
-		((((win-&gt;attr.height + TEXH - 1)&amp; ~(TEXH-1))/TEXH) * ((int)(x/TEXH)) + ((int)(y/TEXW)))
+#define TEXNUM(win, x, y) \
+  ((((win-&gt;attr.height + TEXH - 1)&amp; ~(TEXH-1))/TEXH) * ((int)(x/TEXH)) + ((int)(y/TEXW)))
 
 struct extension {
 	int event, error;
@@ -63,7 +63,7 @@
 	XRenderPictureAttributes  pa;
 	XRenderPictFormat    *format;
 	Picture       picture;
-	int		   already_updated;
+	int     already_updated;
 	int        oid;
 	int        no;
 
@@ -135,7 +135,7 @@
 		name = &quot;Configure!!&quot;;
 	}
 
-/*	printf(&quot;Event: %s\n&quot;, name);*/
+	/* printf(&quot;Event: %s\n&quot;, name);*/
 	return(0);
 }
 
@@ -220,32 +220,32 @@
 
 static void deco_box(struct window *win)
 {
-/*	float vertices[8*3] = {
-		0, 0, 0,
-		1, 0, 0,
-		1, 1, 0,
-		0, 1, 0,
-		0, 0, 1,
-		1, 0, 1,
-		1, 1, 1,
-		0, 1, 1
-	};
-	float sver[8*3];
-	uint32_t polygon[12*4] = {
-		1, 5, 6, 1,
-		1, 6, 2, 1,
-		2, 6, 7, 1,
-		2, 7, 3, 1,
-		4, 0, 3, 1,
-		4, 3, 7, 1,
-		5, 4, 7, 1,
-		5, 7, 6, 1,
-		0, 4, 1, 1,
-		4, 5, 1, 1,
-		0, 1, 2, 0,
-		0, 2, 3, 0
+	/* float vertices[8*3] = {
+	  0, 0, 0,
+	  1, 0, 0,
+	  1, 1, 0,
+	  0, 1, 0,
+	  0, 0, 1,
+	  1, 0, 1,
+	  1, 1, 1,
+	  0, 1, 1
+	 };
+	 float sver[8*3];
+	 uint32_t polygon[12*4] = {
+	  1, 5, 6, 1,
+	  1, 6, 2, 1,
+	  2, 6, 7, 1,
+	  2, 7, 3, 1,
+	  4, 0, 3, 1,
+	  4, 3, 7, 1,
+	  5, 4, 7, 1,
+	  5, 7, 6, 1,
+	  0, 4, 1, 1,
+	  4, 5, 1, 1,
+	  0, 1, 2, 0,
+	  0, 2, 3, 0
 
-	};*/
+	 };*/
 	float tbuf[] = { 0.0, 0.0,  1.0, 0.0,  1.0, 1.0,
 	                 0.0, 0.0,  1.0, 1.0,  0.0, 1.0
 	               };
@@ -255,28 +255,28 @@
 	int xpos, ypos;
 
 	win-&gt;oid = s3d_new_object();
-/*
-	for (i = 0;i &lt; 8;i++) {
-		sver[i*3 + 0] = vertices[i*3+0] * win-&gt;attr.width / 20;
-		sver[i*3 + 1] = vertices[i*3+1] * -win-&gt;attr.height / 20;
-		sver[i*3 + 2] = vertices[i*3+2] * -1;
-	}
-	
-	s3d_push_material_a(win-&gt;oid,
-	                    0.8, 0.0, 0.0 , 1.0,
-	                    1.0, 1.0, 1.0 , 1.0,
-	                    0.8, 0.0, 0.0 , 1.0);
-	s3d_push_texture(win-&gt;oid, win-&gt;attr.width, win-&gt;attr.height);
-	s3d_pep_material_texture(win-&gt;oid, 0); / *  assign texture 0 to material 0 * /
-	s3d_push_material_a(win-&gt;oid,
-	                    0.0, 0.8, 0.0 , 1.0,
-	                    1.0, 1.0, 1.0 , 1.0,
-	                    0.0, 0.8, 0.0 , 1.0);
+	/*
+	 for (i = 0;i &lt; 8;i++) {
+	  sver[i*3 + 0] = vertices[i*3+0] * win-&gt;attr.width / 20;
+	  sver[i*3 + 1] = vertices[i*3+1] * -win-&gt;attr.height / 20;
+	  sver[i*3 + 2] = vertices[i*3+2] * -1;
+	 }
 
-	s3d_push_vertices(win-&gt;oid, sver, 8);
+	 s3d_push_material_a(win-&gt;oid,
+	                     0.8, 0.0, 0.0 , 1.0,
+	                     1.0, 1.0, 1.0 , 1.0,
+	                     0.8, 0.0, 0.0 , 1.0);
+	 s3d_push_texture(win-&gt;oid, win-&gt;attr.width, win-&gt;attr.height);
+	 s3d_pep_material_texture(win-&gt;oid, 0); / *  assign texture 0 to material 0 * /
+	 s3d_push_material_a(win-&gt;oid,
+	                     0.0, 0.8, 0.0 , 1.0,
+	                     1.0, 1.0, 1.0 , 1.0,
+	                     0.0, 0.8, 0.0 , 1.0);
 
-	s3d_push_polygons(win-&gt;oid, polygon, 12);
-	s3d_pep_polygon_tex_coords(win-&gt;oid, tbuf, 2);*/
+	 s3d_push_vertices(win-&gt;oid, sver, 8);
+
+	 s3d_push_polygons(win-&gt;oid, polygon, 12);
+	 s3d_pep_polygon_tex_coords(win-&gt;oid, tbuf, 2);*/
 	voffset = 1;
 	vindex = 0;
 	pindex = 0;
@@ -312,16 +312,15 @@
 	/*  push data on texture 0 position (0,0) */
 	s3d_flags_on(win-&gt;oid, S3D_OF_VISIBLE);
 }
-static struct window *window_find(Window id)
-{
+static struct window *window_find(Window id) {
 	struct window *window;
-	for (window = window_head; window!=NULL; window = window-&gt;next) {
+	for (window = window_head; window != NULL; window = window-&gt;next) {
 		if (window-&gt;id == id)
 			return(window);
 	}
 	printf(&quot;not found (window %d). ;(\n&quot;, (int)id);
 	return(NULL);
-	
+
 }
 
 
@@ -334,7 +333,7 @@
 	win-&gt;id = id;
 	XGetWindowAttributes(dpy, win-&gt;id, &amp;win-&gt;attr);
 
-	win-&gt;no = win_no++;  
+	win-&gt;no = win_no++;
 	/* XSelectInput(dpy, win-&gt;id, ExposureMask|ButtonPressMask|KeyPressMask*/
 	XSelectInput(dpy, win-&gt;id, ExposureMask
 	             | SubstructureNotifyMask | ExposureMask | StructureNotifyMask | PropertyChangeMask);
@@ -364,9 +363,9 @@
 	free(win);
 }
 
-static void window_update_geometry(struct window *win, int x, int y, int width, int height) 
+static void window_update_geometry(struct window *win, int x, int y, int width, int height)
 {
-	
+
 	printf(&quot;window_update_geometry()\n&quot;);
 	if (win-&gt;oid == -1) {
 		win-&gt;attr.x = x;
@@ -374,7 +373,7 @@
 		win-&gt;attr.width = width;
 		win-&gt;attr.height = height;
 
-		window_update_content(win, 0,0, width, height);
+		window_update_content(win, 0, 0, width, height);
 		return;
 	}
 	if ((win-&gt;attr.width == width) &amp;&amp; (win-&gt;attr.height == height)) {
@@ -392,9 +391,9 @@
 		win-&gt;attr.width = width;
 		win-&gt;attr.height = height;
 
-		s3d_del_object(win-&gt;oid);	/* delete the window and redraw */
+		s3d_del_object(win-&gt;oid); /* delete the window and redraw */
 		win-&gt;oid = -1;
-		window_update_content(win, 0,0, width, height);
+		window_update_content(win, 0, 0, width, height);
 
 	}
 }
@@ -410,9 +409,9 @@
 
 
 	if (image-&gt;format == ZPixmap) {
-/*		printf(&quot;XImage: %dx%d, format %d (%d), bpp: %d, depth %d, pad %d\n&quot;,
-		       image-&gt;width, image-&gt;height, image-&gt;format,
-		       ZPixmap, image-&gt;bits_per_pixel, image-&gt;depth, image-&gt;bitmap_pad);*/
+		/*  printf(&quot;XImage: %dx%d, format %d (%d), bpp: %d, depth %d, pad %d\n&quot;,
+		         image-&gt;width, image-&gt;height, image-&gt;format,
+		         ZPixmap, image-&gt;bits_per_pixel, image-&gt;depth, image-&gt;bitmap_pad);*/
 		rs = get_shift(image-&gt;red_mask) - 8;
 		gs = get_shift(image-&gt;green_mask) - 8;
 		bs = get_shift(image-&gt;blue_mask) - 8;
@@ -422,7 +421,7 @@
 		rs = rs;
 		gs = gs - 8;
 		bs = bs - 16;
-/*		printf(&quot;Ximage: rgb: %d|%d|%d\n&quot;, rs, gs, bs);;*/
+		/*  printf(&quot;Ximage: rgb: %d|%d|%d\n&quot;, rs, gs, bs);;*/
 		/*  printf(&quot;red: size %d, offset %d\n&quot;,rs,roff);
 		  printf(&quot;green: size %d, offset %d\n&quot;,gs,goff);
 		  printf(&quot;blue: size %d, offset %d\n&quot;,bs,boff);
@@ -431,8 +430,8 @@
 			img_ptr = image-&gt;data + (y * image-&gt;width) * bpp;
 			bmp_ptr = bitmap + (y * image-&gt;width) * sizeof(uint32_t);
 			for (x = 0; x &lt; image-&gt;width; x++) {
-				s = (unsigned long *)	img_ptr;
-				t = (uint32_t *)		bmp_ptr;
+				s = (unsigned long *) img_ptr;
+				t = (uint32_t *)  bmp_ptr;
 				/*    bmp_ptr[0] = (rs &gt; 0 ? ((*d &amp; image-&gt;red_mask) &gt;&gt; rs)  : ((*d  &amp; image-&gt;red_mask) &lt;&lt; -rs)) ;
 				 bmp_ptr[1] = (gs &gt; 0 ? ((*d &amp; image-&gt;green_mask) &gt;&gt; gs) : ((*d  &amp; image-&gt;green_mask) &lt;&lt; -gs)) ;
 				 bmp_ptr[2] = (bs &gt; 0 ? ((*d &amp; image-&gt;blue_mask) &gt;&gt; bs)  : ((*d  &amp; image-&gt;blue_mask) &lt;&lt; -bs));
@@ -461,17 +460,17 @@
 	XImage *image;
 
 	/* update the whole window for now. */
-/*	x = 50;
-	y = 50;
-	width = win-&gt;attr.width;
-	height = win-&gt;attr.height;*/
+	/* x = 50;
+	 y = 50;
+	 width = win-&gt;attr.width;
+	 height = win-&gt;attr.height;*/
 	if (x &lt; 0) x = 0;
 	if (y &lt; 0) y = 0;
-	if (width &gt; win-&gt;attr.width - x)			width = win-&gt;attr.width - x;
-	if (height &gt; win-&gt;attr.height - y)			height = win-&gt;attr.height - y;
+	if (width &gt; win-&gt;attr.width - x)   width = win-&gt;attr.width - x;
+	if (height &gt; win-&gt;attr.height - y)   height = win-&gt;attr.height - y;
 
 	if (x == 0 &amp;&amp; y == 0 &amp;&amp; width == win-&gt;attr.width &amp;&amp; height == win-&gt;attr.height) {
-		if (win-&gt;already_updated) 
+		if (win-&gt;already_updated)
 			return;
 		else
 			win-&gt;already_updated = 1;
@@ -481,31 +480,31 @@
 	  deco_box(win);
 	*/
 	for (xleft = x; xleft &lt; x + width ; xleft = xright) {
-		xright = (xleft + TEXW) &amp; ~(TEXW-1);
+		xright = (xleft + TEXW) &amp; ~(TEXW - 1);
 		if (xright &gt; (x + width))
 			xright = x + width;
 		chunk_width = xright - xleft;
 		printf(&quot;request image: xleft = %d, xright = %d, width = %d, x:y = %d:%d, width:height = %d:%d, ~TEXW = %08x\n&quot;,
-						xleft, xright, width, x, y, width, height, ~TEXW);
+		       xleft, xright, width, x, y, width, height, ~TEXW);
 		image = XGetImage(dpy, win-&gt;id, xleft, y, chunk_width, height, AllPlanes, ZPixmap);
 		if (!image)
 			return;
 		bitmap = malloc(TEXW * height * sizeof(uint32_t));
-		if (win-&gt;oid == -1) 
+		if (win-&gt;oid == -1)
 			deco_box(win);
-/*		printf(&quot;image_convert\n&quot;);*/
+		/*  printf(&quot;image_convert\n&quot;);*/
 		image_convert(image, bitmap);
-/*		printf(&quot;load textures ...\n&quot;);*/
+		/*  printf(&quot;load textures ...\n&quot;);*/
 		for (ytop = y; ytop &lt; y + height; ytop = ybottom) {
-			ybottom = (ytop + TEXH) &amp; ~(TEXH-1);
+			ybottom = (ytop + TEXH) &amp; ~(TEXH - 1);
 			chunk_height = ybottom - ytop;
-			s3d_load_texture(win-&gt;oid, TEXNUM(win, xleft, ytop), xleft % TEXW, ytop % TEXH, 
-								chunk_width, chunk_height, (unsigned char *)bitmap + chunk_width * (ytop - y) * 4);
-/*			printf(&quot;s3d_load_texture(%d, %d, %d, %d, %d, %d, %010p);\n&quot;,
-							win-&gt;oid, TEXNUM(win, xleft, ytop), xleft % TEXW, ytop % TEXH, 
-								chunk_width, chunk_height, (unsigned char *)bitmap + chunk_width * (ytop - y) * 4);*/
+			s3d_load_texture(win-&gt;oid, TEXNUM(win, xleft, ytop), xleft % TEXW, ytop % TEXH,
+			                 chunk_width, chunk_height, (unsigned char *)bitmap + chunk_width * (ytop - y) * 4);
+			/*   printf(&quot;s3d_load_texture(%d, %d, %d, %d, %d, %d, %010p);\n&quot;,
+			       win-&gt;oid, TEXNUM(win, xleft, ytop), xleft % TEXW, ytop % TEXH,
+			        chunk_width, chunk_height, (unsigned char *)bitmap + chunk_width * (ytop - y) * 4);*/
 		}
-/*		printf(&quot;done loading textures\n&quot;); */
+		/*  printf(&quot;done loading textures\n&quot;); */
 		XDestroyImage(image);
 		free(bitmap);
 	}
@@ -517,27 +516,27 @@
 	XEvent event;
 	struct window *window;
 	int i;
-	for (window = window_head; window!=NULL; window = window-&gt;next) 
+	for (window = window_head; window != NULL; window = window-&gt;next)
 		window-&gt;already_updated = 0;
 
-	for (i=0; i&lt; MAXEVENTS &amp;&amp; XPending(dpy); i++) {
+	for (i = 0; i &lt; MAXEVENTS &amp;&amp; XPending(dpy); i++) {
 		XNextEvent(dpy, &amp;event);
 		print_event(dpy, &amp;event);
 		if (event.type == xdamage.event + XDamageNotify) {
 			XDamageNotifyEvent *e = (XDamageNotifyEvent*) &amp; event;
-/*			printf(&quot;window = %d, geometry = %d:%d (at %d:%d), area = %d:%d (at %d:%d)\n&quot;,
-			       (int)e-&gt;drawable, e-&gt;geometry.width, e-&gt;geometry.height, e-&gt;geometry.x, e-&gt;geometry.y,
-			       e-&gt;area.width, e-&gt;area.height, e-&gt;area.x, e-&gt;area.y);*/
+			/*   printf(&quot;window = %d, geometry = %d:%d (at %d:%d), area = %d:%d (at %d:%d)\n&quot;,
+			          (int)e-&gt;drawable, e-&gt;geometry.width, e-&gt;geometry.height, e-&gt;geometry.x, e-&gt;geometry.y,
+			          e-&gt;area.width, e-&gt;area.height, e-&gt;area.x, e-&gt;area.y);*/
 			XDamageSubtract(dpy, e-&gt;damage, None, None);
 			window = window_find(e-&gt;drawable);
-			if (window!=NULL)
+			if (window != NULL)
 				window_update_content(window, e-&gt;area.x, e-&gt;area.y, e-&gt;area.width, e-&gt;area.height);
 		} else if (event.type == ConfigureNotify) {
-			XConfigureEvent *e = &amp;event.xconfigure; 
+			XConfigureEvent *e = &amp;event.xconfigure;
 			window = window_find(e-&gt;window);
 			if (window != NULL) {
-/*				printf(&quot;Configure: window = %d, geometry = %d:%d (at %d:%d)\n&quot;,
-				       (int)e-&gt;window, e-&gt;width, e-&gt;height, e-&gt;x, e-&gt;y);*/
+				/*    printf(&quot;Configure: window = %d, geometry = %d:%d (at %d:%d)\n&quot;,
+				           (int)e-&gt;window, e-&gt;width, e-&gt;height, e-&gt;x, e-&gt;y);*/
 				window_update_geometry(window, e-&gt;x, e-&gt;y, e-&gt;width, e-&gt;height);
 			} else {
 				printf(&quot;Configure: Could not find window to configure.\n&quot;);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000781.html">[S3d-svn] r789 - trunk/apps/comptest
</A></li>
	<LI>Next message: <A HREF="000783.html">[S3d-svn] r791 - trunk/apps/comptest
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#782">[ date ]</a>
              <a href="thread.html#782">[ thread ]</a>
              <a href="subject.html#782">[ subject ]</a>
              <a href="author.html#782">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/s3d-svn">More information about the S3d-svn
mailing list</a><br>
</body></html>
